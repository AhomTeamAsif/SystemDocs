<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Price Aggregation &amp; Analytics Engine - SystemDocs</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><li class="part-title">Crypto Market Data Aggregator</li><li class="chapter-item expanded "><a href="../../Crypto_Market_Data/introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../../Crypto_Market_Data/Feature_List/feature_list.html"><strong aria-hidden="true">2.</strong> Features Overview </a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../Crypto_Market_Data/Feature_List/1-blockchain-data-infrastructure.html"><strong aria-hidden="true">2.1.</strong> BLOCKCHAIN DATA INFRASTRUCTURE</a></li><li class="chapter-item expanded "><a href="../../Crypto_Market_Data/Feature_List/2-centralized-exchange-cex-integration.html"><strong aria-hidden="true">2.2.</strong> CENTRALIZED EXCHANGE (CEX) INTEGRATION</a></li><li class="chapter-item expanded "><a href="../../Crypto_Market_Data/Feature_List/3-decentralized-exchange-dex-integration.html"><strong aria-hidden="true">2.3.</strong> DECENTRALIZED EXCHANGE (DEX) INTEGRATION</a></li><li class="chapter-item expanded "><a href="../../Crypto_Market_Data/Feature_List/4-price-aggregation--analytics-engine.html"><strong aria-hidden="true">2.4.</strong> PRICE AGGREGATION & ANALYTICS ENGINE</a></li><li class="chapter-item expanded "><a href="../../Crypto_Market_Data/Feature_List/5-time-series-data-generation.html"><strong aria-hidden="true">2.5.</strong> TIME-SERIES DATA GENERATION</a></li><li class="chapter-item expanded "><a href="../../Crypto_Market_Data/Feature_List/6-advanced-analytics-features.html"><strong aria-hidden="true">2.6.</strong> ADVANCED ANALYTICS FEATURES</a></li><li class="chapter-item expanded "><a href="../../Crypto_Market_Data/Feature_List/7-user-authentication--authorization.html"><strong aria-hidden="true">2.7.</strong> USER AUTHENTICATION & AUTHORIZATION</a></li><li class="chapter-item expanded "><a href="../../Crypto_Market_Data/Feature_List/8-api-key-management--authentication.html"><strong aria-hidden="true">2.8.</strong> API KEY MANAGEMENT & AUTHENTICATION</a></li><li class="chapter-item expanded "><a href="../../Crypto_Market_Data/Feature_List/9-subscription--billing-management.html"><strong aria-hidden="true">2.9.</strong> SUBSCRIPTION & BILLING MANAGEMENT</a></li><li class="chapter-item expanded "><a href="../../Crypto_Market_Data/Feature_List/10-rate-limiting--quota-management.html"><strong aria-hidden="true">2.10.</strong> RATE LIMITING & QUOTA MANAGEMENT</a></li><li class="chapter-item expanded "><a href="../../Crypto_Market_Data/Feature_List/11-api--data-distribution.html"><strong aria-hidden="true">2.11.</strong> API & DATA DISTRIBUTION</a></li><li class="chapter-item expanded "><a href="../../Crypto_Market_Data/Feature_List/12-real-time-data-streaming.html"><strong aria-hidden="true">2.12.</strong> REAL-TIME DATA STREAMING</a></li><li class="chapter-item expanded "><a href="../../Crypto_Market_Data/Feature_List/13-compliance--security.html"><strong aria-hidden="true">2.13.</strong> COMPLIANCE & SECURITY</a></li></ol></li><li class="chapter-item expanded "><a href="../../Crypto_Market_Data/Data_Defination_Sheet/data_definition_sheet.html"><strong aria-hidden="true">3.</strong>  Data Definition Overview</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../Crypto_Market_Data/Data_Defination_Sheet/1-blockchain-data-infrastructure.html"><strong aria-hidden="true">3.1.</strong> Blockchain Data Infrastructure</a></li><li class="chapter-item expanded "><a href="../../Crypto_Market_Data/Data_Defination_Sheet/2-centralized-exchange-cex-integration.html"><strong aria-hidden="true">3.2.</strong> Centralized Exchange (CEX) Integration</a></li><li class="chapter-item expanded "><a href="../../Crypto_Market_Data/Data_Defination_Sheet/3-decentralized-exchange-dex-integration.html"><strong aria-hidden="true">3.3.</strong> Decentralized Exchange (DEX) Integration</a></li><li class="chapter-item expanded "><a href="../../Crypto_Market_Data/Data_Defination_Sheet/4-price-aggregation--analytics-engine.html" class="active"><strong aria-hidden="true">3.4.</strong> Price Aggregation & Analytics Engine</a></li><li class="chapter-item expanded "><a href="../../Crypto_Market_Data/Data_Defination_Sheet/5-time-series-data-generation.html"><strong aria-hidden="true">3.5.</strong> Time-Series Data Generation</a></li><li class="chapter-item expanded "><a href="../../Crypto_Market_Data/Data_Defination_Sheet/6-advanced-analytics-features.html"><strong aria-hidden="true">3.6.</strong> Advanced Analytics Features</a></li><li class="chapter-item expanded "><a href="../../Crypto_Market_Data/Data_Defination_Sheet/7-api-key-management--authentication.html"><strong aria-hidden="true">3.7.</strong> API Key Management & Authentication</a></li><li class="chapter-item expanded "><a href="../../Crypto_Market_Data/Data_Defination_Sheet/12-subscription--billing-management.html"><strong aria-hidden="true">3.8.</strong> Subscription & Billing Management</a></li><li class="chapter-item expanded "><a href="../../Crypto_Market_Data/Data_Defination_Sheet/8-rate-limiting--quota-management.html"><strong aria-hidden="true">3.9.</strong> Rate Limiting & Quota Management</a></li><li class="chapter-item expanded "><a href="../../Crypto_Market_Data/Data_Defination_Sheet/9-api-data-distribution.html"><strong aria-hidden="true">3.10.</strong> API & Data Distribution</a></li><li class="chapter-item expanded "><a href="../../Crypto_Market_Data/Data_Defination_Sheet/10-real-time-data-streamin.html"><strong aria-hidden="true">3.11.</strong> Real-Time Data Streaming</a></li><li class="chapter-item expanded "><a href="../../Crypto_Market_Data/Data_Defination_Sheet/11-compliance--security.html"><strong aria-hidden="true">3.12.</strong> Compliance & Security</a></li></ol></li><li class="chapter-item expanded "><a href="../../class_diagram.html"><strong aria-hidden="true">4.</strong> Class Diagram</a></li><li class="chapter-item expanded "><a href="../../er_diagram.html"><strong aria-hidden="true">5.</strong> ER Diagram</a></li><li class="chapter-item expanded "><a href="../../dfd.html"><strong aria-hidden="true">6.</strong> Data Flow Diagram (DFD)</a></li><li class="chapter-item expanded affix "><li class="part-title">RPC Node Provider Service</li><li class="chapter-item expanded "><a href="../../Introduction_rpc.html"><strong aria-hidden="true">7.</strong> RPC Node Provider Service</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">SystemDocs</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="price-aggregation--analytics-engine"><a class="header" href="#price-aggregation--analytics-engine">Price Aggregation &amp; Analytics Engine</a></h1>
<h3 id="overview"><a class="header" href="#overview">Overview</a></h3>
<p>This document specifies the data models required for the platform's advanced Price Aggregation &amp; Analytics Engine. These structures are designed to support the calculation and storage of authoritative consensus prices, dynamic source weightings, analytical benchmarks like VWAP, and the auditable filtering of price outliers. The goal is to transform raw data from hundreds of CEX and DEX sources into reliable, high-quality market intelligence.</p>
<h3 id="aggregatedprice"><a class="header" href="#aggregatedprice">AggregatedPrice</a></h3>
<p>Stores the final, authoritative consensus price and fair value estimations for each asset, supporting features PA-001 and PA-007.</p>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Type</th><th>Required?</th><th>Format</th><th>Description</th></tr></thead><tbody>
<tr><td>asset_id</td><td>UUID</td><td>Yes</td><td>UUID</td><td>Foreign key to the Asset table. Part of the composite primary key.</td></tr>
<tr><td>timestamp</td><td>Timestamp</td><td>Yes</td><td>ISO 8601</td><td>The time for which this price is valid. Part of the composite primary key.</td></tr>
<tr><td>price_type</td><td>Enum</td><td>Yes</td><td>CONSENSUS, FAIR_VALUE</td><td>The type of price calculation. Part of the composite primary key.</td></tr>
<tr><td>price_usd</td><td>Decimal(36,18)</td><td>Yes</td><td>Numeric</td><td>The calculated authoritative price in USD.</td></tr>
<tr><td>confidence_score</td><td>Float</td><td>Yes</td><td>0.0 - 1.0</td><td>A score indicating the system's confidence in the accuracy of the calculated price.</td></tr>
<tr><td>contributing_sources</td><td>Integer</td><td>Yes</td><td>Numeric</td><td>The number of individual data sources used in this calculation.</td></tr>
<tr><td>metadata</td><td>JSON</td><td>No</td><td>JSON object</td><td>Additional details, e.g., confidence intervals or factors used in fair value calculation.</td></tr>
</tbody></table>
</div>
<h3 id="sourceweight"><a class="header" href="#sourceweight">SourceWeight</a></h3>
<p>Stores the dynamically calculated weight for each trading venue, used to determine its influence on the consensus price, supporting PA-003.</p>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Type</th><th>Required?</th><th>Format</th><th>Description</th></tr></thead><tbody>
<tr><td>source_id</td><td>UUID</td><td>Yes</td><td>UUID</td><td>The ID of the source (e.g., CEX market_id or DEX pool_id). Part of a composite key.</td></tr>
<tr><td>source_type</td><td>Enum</td><td>Yes</td><td>CEX_MARKET, DEX_POOL</td><td>The type of the data source. Part of a composite key.</td></tr>
<tr><td>calculated_at</td><td>Timestamp</td><td>Yes</td><td>ISO 8601</td><td>The timestamp when this weight was calculated. Part of a composite key.</td></tr>
<tr><td>weight</td><td>Float</td><td>Yes</td><td>0.0 - 1.0</td><td>The final calculated weight for the source, representing its overall influence.</td></tr>
<tr><td>volume_score</td><td>Float</td><td>No</td><td>0.0 - 1.0</td><td>Component score based on the source's relative trading volume.</td></tr>
<tr><td>reliability_score</td><td>Float</td><td>No</td><td>0.0 - 1.0</td><td>Component score based on the source's historical uptime and data quality.</td></tr>
<tr><td>details</td><td>JSON</td><td>No</td><td>JSON object</td><td>Additional metrics that contributed to the final weight.</td></tr>
</tbody></table>
</div>
<h3 id="priceoutlierlog"><a class="header" href="#priceoutlierlog">PriceOutlierLog</a></h3>
<p>An audit trail for the outlier detection algorithm, logging all filtered or flagged price points, supporting PA-002.</p>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Type</th><th>Required?</th><th>Format</th><th>Description</th></tr></thead><tbody>
<tr><td>log_id</td><td>UUID</td><td>Yes</td><td>UUID</td><td>Unique identifier for the log entry.</td></tr>
<tr><td>source_id</td><td>UUID</td><td>Yes</td><td>UUID</td><td>The ID of the source that produced the outlier (e.g., market_id or pool_id).</td></tr>
<tr><td>source_type</td><td>Enum</td><td>Yes</td><td>CEX_MARKET, DEX_POOL</td><td>The type of the data source.</td></tr>
<tr><td>outlier_price</td><td>Decimal(36,18)</td><td>Yes</td><td>Numeric</td><td>The anomalous price that was detected.</td></tr>
<tr><td>consensus_price</td><td>Decimal(36,18)</td><td>Yes</td><td>Numeric</td><td>The market consensus price at the time of detection for comparison.</td></tr>
<tr><td>deviation_percent</td><td>Float</td><td>Yes</td><td>Numeric</td><td>The percentage deviation of the outlier from the consensus price.</td></tr>
<tr><td>action_taken</td><td>Enum</td><td>Yes</td><td>FILTERED, FLAGGED</td><td>The action taken by the system (e.g., excluded from calculation or just flagged).</td></tr>
<tr><td>detected_at</td><td>Timestamp</td><td>Yes</td><td>ISO 8601</td><td>The time the outlier was detected.</td></tr>
</tbody></table>
</div>
<h3 id="calculatedbenchmark"><a class="header" href="#calculatedbenchmark">CalculatedBenchmark</a></h3>
<p>Stores the results of VWAP and TWAP calculations, supporting PA-006.</p>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Type</th><th>Required?</th><th>Format</th><th>Description</th></tr></thead><tbody>
<tr><td>asset_id</td><td>UUID</td><td>Yes</td><td>UUID</td><td>Foreign key to the Asset table. Part of the composite primary key.</td></tr>
<tr><td>benchmark_type</td><td>Enum</td><td>Yes</td><td>VWAP, TWAP</td><td>The type of benchmark calculated. Part of the composite primary key.</td></tr>
<tr><td>start_time</td><td>Timestamp</td><td>Yes</td><td>ISO 8601</td><td>The beginning of the time window for the calculation. Part of the composite primary key.</td></tr>
<tr><td>end_time</td><td>Timestamp</td><td>Yes</td><td>ISO 8601</td><td>The end of the time window for the calculation.</td></tr>
<tr><td>value</td><td>Decimal(36,18)</td><td>Yes</td><td>Numeric</td><td>The calculated value of the benchmark (e.g., the VWAP price).</td></tr>
<tr><td>total_volume</td><td>Decimal(36,18)</td><td>No</td><td>Numeric</td><td>The total volume during the window, primarily for VWAP.</td></tr>
</tbody></table>
</div>
<h3 id="relations-between-tables"><a class="header" href="#relations-between-tables">Relations between Tables</a></h3>
<ul>
<li><strong>AggregatedPrice table:</strong> This is a primary output table, storing the final consensus and fair value prices for each asset. It is the result of aggregating data from numerous sources, weighted by the SourceWeight table.</li>
<li><strong>SourceWeight table:</strong> This table stores a dynamically calculated &quot;trust score&quot; or weight for every individual data source (e.g., a specific market on a CEX or a liquidity pool on a DEX). These weights are a key input for the consensus price calculation in the AggregatedPrice table.</li>
<li><strong>PriceOutlierLog table:</strong> This table acts as an audit trail, recording every time a price point from a source is flagged or filtered out by the outlier detection algorithm. It provides transparency into the data cleansing process.</li>
<li><strong>CalculatedBenchmark table:</strong> This table stores the results of complex analytical calculations, such as VWAP and TWAP, for each asset over various timeframes. It provides standardized benchmarks for traders and analysts.</li>
</ul>
<h3 id="entities--relationships"><a class="header" href="#entities--relationships">Entities &amp; Relationships</a></h3>
<ul>
<li><strong>AggregatedPrice</strong>
<ul>
<li>asset_id (PK, FK → Asset.asset_id)</li>
<li>timestamp (PK)</li>
<li>price_type (PK)</li>
</ul>
</li>
<li><strong>SourceWeight</strong>
<ul>
<li>source_id (PK)</li>
<li>source_type (PK)</li>
<li>calculated_at (PK)</li>
</ul>
</li>
<li><strong>PriceOutlierLog</strong>
<ul>
<li>log_id (PK)</li>
</ul>
</li>
<li><strong>CalculatedBenchmark</strong>
<ul>
<li>asset_id (PK, FK → Asset.asset_id)</li>
<li>benchmark_type (PK)</li>
<li>start_time (PK)</li>
</ul>
</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../Crypto_Market_Data/Data_Defination_Sheet/3-decentralized-exchange-dex-integration.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../../Crypto_Market_Data/Data_Defination_Sheet/5-time-series-data-generation.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../Crypto_Market_Data/Data_Defination_Sheet/3-decentralized-exchange-dex-integration.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../../Crypto_Market_Data/Data_Defination_Sheet/5-time-series-data-generation.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
