<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Subscription &amp; Billing Management - SystemDocs</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><li class="part-title">Crypto Market Data Aggregator</li><li class="chapter-item expanded "><a href="../../Crypto_Market_Data/introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../../Crypto_Market_Data/Feature_List/feature_list.html"><strong aria-hidden="true">2.</strong> Features Overview </a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../Crypto_Market_Data/Feature_List/1-blockchain-data-infrastructure.html"><strong aria-hidden="true">2.1.</strong> BLOCKCHAIN DATA INFRASTRUCTURE</a></li><li class="chapter-item expanded "><a href="../../Crypto_Market_Data/Feature_List/2-centralized-exchange-cex-integration.html"><strong aria-hidden="true">2.2.</strong> CENTRALIZED EXCHANGE (CEX) INTEGRATION</a></li><li class="chapter-item expanded "><a href="../../Crypto_Market_Data/Feature_List/3-decentralized-exchange-dex-integration.html"><strong aria-hidden="true">2.3.</strong> DECENTRALIZED EXCHANGE (DEX) INTEGRATION</a></li><li class="chapter-item expanded "><a href="../../Crypto_Market_Data/Feature_List/4-price-aggregation--analytics-engine.html"><strong aria-hidden="true">2.4.</strong> PRICE AGGREGATION & ANALYTICS ENGINE</a></li><li class="chapter-item expanded "><a href="../../Crypto_Market_Data/Feature_List/5-time-series-data-generation.html"><strong aria-hidden="true">2.5.</strong> TIME-SERIES DATA GENERATION</a></li><li class="chapter-item expanded "><a href="../../Crypto_Market_Data/Feature_List/6-advanced-analytics-features.html"><strong aria-hidden="true">2.6.</strong> ADVANCED ANALYTICS FEATURES</a></li><li class="chapter-item expanded "><a href="../../Crypto_Market_Data/Feature_List/7-user-authentication--authorization.html"><strong aria-hidden="true">2.7.</strong> USER AUTHENTICATION & AUTHORIZATION</a></li><li class="chapter-item expanded "><a href="../../Crypto_Market_Data/Feature_List/8-api-key-management--authentication.html"><strong aria-hidden="true">2.8.</strong> API KEY MANAGEMENT & AUTHENTICATION</a></li><li class="chapter-item expanded "><a href="../../Crypto_Market_Data/Feature_List/9-subscription--billing-management.html"><strong aria-hidden="true">2.9.</strong> SUBSCRIPTION & BILLING MANAGEMENT</a></li><li class="chapter-item expanded "><a href="../../Crypto_Market_Data/Feature_List/10-rate-limiting--quota-management.html"><strong aria-hidden="true">2.10.</strong> RATE LIMITING & QUOTA MANAGEMENT</a></li><li class="chapter-item expanded "><a href="../../Crypto_Market_Data/Feature_List/11-api--data-distribution.html"><strong aria-hidden="true">2.11.</strong> API & DATA DISTRIBUTION</a></li><li class="chapter-item expanded "><a href="../../Crypto_Market_Data/Feature_List/12-real-time-data-streaming.html"><strong aria-hidden="true">2.12.</strong> REAL-TIME DATA STREAMING</a></li><li class="chapter-item expanded "><a href="../../Crypto_Market_Data/Feature_List/13-compliance--security.html"><strong aria-hidden="true">2.13.</strong> COMPLIANCE & SECURITY</a></li></ol></li><li class="chapter-item expanded "><a href="../../Crypto_Market_Data/Data_Defination_Sheet/data_definition_sheet.html"><strong aria-hidden="true">3.</strong>  Data Definition Overview</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../Crypto_Market_Data/Data_Defination_Sheet/1-blockchain-data-infrastructure.html"><strong aria-hidden="true">3.1.</strong> Blockchain Data Infrastructure</a></li><li class="chapter-item expanded "><a href="../../Crypto_Market_Data/Data_Defination_Sheet/2-centralized-exchange-cex-integration.html"><strong aria-hidden="true">3.2.</strong> Centralized Exchange (CEX) Integration</a></li><li class="chapter-item expanded "><a href="../../Crypto_Market_Data/Data_Defination_Sheet/3-decentralized-exchange-dex-integration.html"><strong aria-hidden="true">3.3.</strong> Decentralized Exchange (DEX) Integration</a></li><li class="chapter-item expanded "><a href="../../Crypto_Market_Data/Data_Defination_Sheet/4-price-aggregation--analytics-engine.html"><strong aria-hidden="true">3.4.</strong> Price Aggregation & Analytics Engine</a></li><li class="chapter-item expanded "><a href="../../Crypto_Market_Data/Data_Defination_Sheet/5-time-series-data-generation.html"><strong aria-hidden="true">3.5.</strong> Time-Series Data Generation</a></li><li class="chapter-item expanded "><a href="../../Crypto_Market_Data/Data_Defination_Sheet/6-advanced-analytics-features.html"><strong aria-hidden="true">3.6.</strong> Advanced Analytics Features</a></li><li class="chapter-item expanded "><a href="../../Crypto_Market_Data/Data_Defination_Sheet/7-api-key-management--authentication.html"><strong aria-hidden="true">3.7.</strong> API Key Management & Authentication</a></li><li class="chapter-item expanded "><a href="../../Crypto_Market_Data/Data_Defination_Sheet/12-subscription--billing-management.html" class="active"><strong aria-hidden="true">3.8.</strong> Subscription & Billing Management</a></li><li class="chapter-item expanded "><a href="../../Crypto_Market_Data/Data_Defination_Sheet/8-rate-limiting--quota-management.html"><strong aria-hidden="true">3.9.</strong> Rate Limiting & Quota Management</a></li><li class="chapter-item expanded "><a href="../../Crypto_Market_Data/Data_Defination_Sheet/9-api-data-distribution.html"><strong aria-hidden="true">3.10.</strong> API & Data Distribution</a></li><li class="chapter-item expanded "><a href="../../Crypto_Market_Data/Data_Defination_Sheet/10-real-time-data-streamin.html"><strong aria-hidden="true">3.11.</strong> Real-Time Data Streaming</a></li><li class="chapter-item expanded "><a href="../../Crypto_Market_Data/Data_Defination_Sheet/11-compliance--security.html"><strong aria-hidden="true">3.12.</strong> Compliance & Security</a></li></ol></li><li class="chapter-item expanded "><a href="../../class_diagram.html"><strong aria-hidden="true">4.</strong> Class Diagram</a></li><li class="chapter-item expanded "><a href="../../er_diagram.html"><strong aria-hidden="true">5.</strong> ER Diagram</a></li><li class="chapter-item expanded "><a href="../../dfd.html"><strong aria-hidden="true">6.</strong> Data Flow Diagram (DFD)</a></li><li class="chapter-item expanded affix "><li class="part-title">RPC Node Provider Service</li><li class="chapter-item expanded "><a href="../../Introduction_rpc.html"><strong aria-hidden="true">7.</strong> RPC Node Provider Service</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">SystemDocs</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="subscription--billing-management-data-specification"><a class="header" href="#subscription--billing-management-data-specification">Subscription &amp; Billing Management Data Specification</a></h1>
<h2 id="overview"><a class="header" href="#overview">Overview</a></h2>
<p>This document details the data models that support the platform's Subscription &amp; Billing Management features. These structures are designed to store subscription tier definitions, payment processing information, usage tracking metrics, enterprise contract management data, and a complete invoicing system. The primary purpose of these models is to enable flexible subscription management, accurate and auditable billing, and comprehensive usage monitoring for diverse user segments from individual developers to enterprise clients.</p>
<hr />
<h2 id="relations-between-tables"><a class="header" href="#relations-between-tables">Relations between Tables</a></h2>
<ul>
<li><strong>SubscriptionTier</strong>: Defines the available subscription plans and their associated limits and features. It serves as a master template for what each subscription entails.</li>
<li><strong>UserSubscription</strong>: Links a User to a SubscriptionTier and tracks the subscription's lifecycle. It has a many-to-one relationship with SubscriptionTier and a one-to-one relationship with User. This table has been updated to include a direct link to the specific PaymentMethod to be used for renewals.</li>
<li><strong>PaymentMethod</strong>: Stores user payment information for automated billing. It has a many-to-one relationship with User, allowing multiple payment methods per user.</li>
<li><strong>Invoice (New)</strong>: Represents a bill issued to a user for a specific billing period. It aggregates charges from subscriptions and usage overages. It has a many-to-one relationship with User.</li>
<li><strong>InvoiceLineItem (New)</strong>: Details the specific charges on an invoice, such as the base subscription fee or usage overage costs. It has a many-to-one relationship with the Invoice table.</li>
<li><strong>UsageMetric</strong>: A time-series table that tracks all billable activities. It has a many-to-one relationship with User. Overage metrics can now be linked directly to the Invoice on which they were billed.</li>
<li><strong>EnterpriseContract</strong>: Stores bespoke contract terms for enterprise clients. It has a one-to-one relationship with User for enterprise accounts.</li>
</ul>
<hr />
<h2 id="subscriptiontier"><a class="header" href="#subscriptiontier">SubscriptionTier</a></h2>
<p>Defines available subscription tiers with their features, limits, and pricing, supporting feature SB-001.</p>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Type</th><th>Required?</th><th>Format</th><th>Description</th></tr></thead><tbody>
<tr><td>tier_id</td><td>UUID</td><td>Yes</td><td>UUID</td><td>Primary key for the subscription tier.</td></tr>
<tr><td>tier_name</td><td>String</td><td>Yes</td><td>e.g., &quot;Free&quot;, &quot;Professional&quot;</td><td>Human-readable name of the subscription tier.</td></tr>
<tr><td>tier_level</td><td>Integer</td><td>Yes</td><td>0-100</td><td>Numeric level for tier comparison (0=Free, 100=Enterprise).</td></tr>
<tr><td>monthly_price</td><td>Decimal</td><td>Yes</td><td>Currency format</td><td>Monthly subscription price in USD.</td></tr>
<tr><td>annual_price</td><td>Decimal</td><td>No</td><td>Currency format</td><td>Annual subscription price in USD (if applicable).</td></tr>
<tr><td>api_rate_limit</td><td>Integer</td><td>Yes</td><td>Requests per minute</td><td>Maximum API requests allowed per minute.</td></tr>
<tr><td>daily_quota</td><td>Integer</td><td>Yes</td><td>Number</td><td>Maximum API calls allowed per day.</td></tr>
<tr><td>historical_data_days</td><td>Integer</td><td>Yes</td><td>Days</td><td>Number of days of historical data access allowed.</td></tr>
<tr><td>support_level</td><td>Enum</td><td>Yes</td><td>COMMUNITY, EMAIL, PRIORITY, DEDICATED</td><td>Level of customer support provided.</td></tr>
<tr><td>features</td><td>JSON</td><td>Yes</td><td>JSON array</td><td>List of enabled features or capabilities.</td></tr>
<tr><td>is_active</td><td>Boolean</td><td>Yes</td><td>true/false</td><td>Whether this tier is currently available.</td></tr>
<tr><td>created_at</td><td>Timestamp</td><td>Yes</td><td>ISO 8601</td><td>When this tier was created.</td></tr>
<tr><td>updated_at</td><td>Timestamp</td><td>Yes</td><td>ISO 8601</td><td>When this tier was last modified.</td></tr>
</tbody></table>
</div>
<hr />
<h2 id="usersubscription"><a class="header" href="#usersubscription">UserSubscription</a></h2>
<p>Tracks user subscription status and lifecycle. This table has been modified to link directly to a payment method for renewals, supporting features SB-001 and SB-004.</p>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Type</th><th>Required?</th><th>Format</th><th>Description</th></tr></thead><tbody>
<tr><td>subscription_id</td><td>UUID</td><td>Yes</td><td>UUID</td><td>Primary key.</td></tr>
<tr><td>user_id</td><td>UUID</td><td>Yes</td><td>UUID</td><td>FK to User.</td></tr>
<tr><td>tier_id</td><td>UUID</td><td>Yes</td><td>UUID</td><td>FK to SubscriptionTier.</td></tr>
<tr><td>payment_method_id</td><td>UUID</td><td>No</td><td>UUID</td><td>FK to PaymentMethod.</td></tr>
<tr><td>status</td><td>Enum</td><td>Yes</td><td>TRIAL, ACTIVE, CANCELLED, SUSPENDED, EXPIRED</td><td>Current subscription status.</td></tr>
<tr><td>start_date</td><td>Timestamp</td><td>Yes</td><td>ISO 8601</td><td>Start date.</td></tr>
<tr><td>end_date</td><td>Timestamp</td><td>No</td><td>ISO 8601</td><td>End date (null if ongoing).</td></tr>
<tr><td>trial_end_date</td><td>Timestamp</td><td>No</td><td>ISO 8601</td><td>End of trial period.</td></tr>
<tr><td>billing_cycle</td><td>Enum</td><td>Yes</td><td>MONTHLY, ANNUAL</td><td>Billing frequency.</td></tr>
<tr><td>auto_renew</td><td>Boolean</td><td>Yes</td><td>true/false</td><td>Whether auto-renews.</td></tr>
<tr><td>cancellation_reason</td><td>String</td><td>No</td><td>Free text</td><td>Reason for cancellation.</td></tr>
<tr><td>created_at</td><td>Timestamp</td><td>Yes</td><td>ISO 8601</td><td>Creation time.</td></tr>
<tr><td>updated_at</td><td>Timestamp</td><td>Yes</td><td>ISO 8601</td><td>Last update.</td></tr>
</tbody></table>
</div>
<hr />
<h2 id="paymentmethod"><a class="header" href="#paymentmethod">PaymentMethod</a></h2>
<p>Stores user payment information for automated billing, supporting feature SB-002.</p>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Type</th><th>Required?</th><th>Format</th><th>Description</th></tr></thead><tbody>
<tr><td>payment_method_id</td><td>UUID</td><td>Yes</td><td>UUID</td><td>Primary key.</td></tr>
<tr><td>user_id</td><td>UUID</td><td>Yes</td><td>UUID</td><td>FK to User.</td></tr>
<tr><td>provider</td><td>Enum</td><td>Yes</td><td>STRIPE, PAYPAL, BANK_TRANSFER, CRYPTO</td><td>Payment provider.</td></tr>
<tr><td>provider_payment_id</td><td>String</td><td>Yes</td><td>Provider-specific</td><td>External provider ID.</td></tr>
<tr><td>method_type</td><td>Enum</td><td>Yes</td><td>CREDIT_CARD, DEBIT_CARD, BANK_ACCOUNT, CRYPTO_WALLET</td><td>Method type.</td></tr>
<tr><td>last_four_digits</td><td>String</td><td>No</td><td>4 digits</td><td>Display-only card/account suffix.</td></tr>
<tr><td>expiry_month</td><td>Integer</td><td>No</td><td>1-12</td><td>Expiry month.</td></tr>
<tr><td>expiry_year</td><td>Integer</td><td>No</td><td>YYYY</td><td>Expiry year.</td></tr>
<tr><td>is_default</td><td>Boolean</td><td>Yes</td><td>true/false</td><td>Default method?</td></tr>
<tr><td>is_verified</td><td>Boolean</td><td>Yes</td><td>true/false</td><td>Verified status.</td></tr>
<tr><td>created_at</td><td>Timestamp</td><td>Yes</td><td>ISO 8601</td><td>Created at.</td></tr>
<tr><td>updated_at</td><td>Timestamp</td><td>Yes</td><td>ISO 8601</td><td>Updated at.</td></tr>
</tbody></table>
</div>
<hr />
<h2 id="invoice"><a class="header" href="#invoice">Invoice</a></h2>
<p>Represents a single, auditable bill issued to a user for a specific billing period.</p>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Type</th><th>Required?</th><th>Format</th><th>Description</th></tr></thead><tbody>
<tr><td>invoice_id</td><td>UUID</td><td>Yes</td><td>UUID</td><td>Primary key.</td></tr>
<tr><td>user_id</td><td>UUID</td><td>Yes</td><td>UUID</td><td>FK to User.</td></tr>
<tr><td>subscription_id</td><td>UUID</td><td>Yes</td><td>UUID</td><td>FK to UserSubscription.</td></tr>
<tr><td>status</td><td>Enum</td><td>Yes</td><td>DRAFT, OPEN, PAID, VOID, UNCOLLECTIBLE</td><td>Invoice status.</td></tr>
<tr><td>issue_date</td><td>Timestamp</td><td>Yes</td><td>ISO 8601</td><td>Issue date.</td></tr>
<tr><td>due_date</td><td>Timestamp</td><td>Yes</td><td>ISO 8601</td><td>Due date.</td></tr>
<tr><td>paid_date</td><td>Timestamp</td><td>No</td><td>ISO 8601</td><td>Paid date.</td></tr>
<tr><td>billing_period_start</td><td>Timestamp</td><td>Yes</td><td>ISO 8601</td><td>Billing period start.</td></tr>
<tr><td>billing_period_end</td><td>Timestamp</td><td>Yes</td><td>ISO 8601</td><td>Billing period end.</td></tr>
<tr><td>total_amount</td><td>Decimal</td><td>Yes</td><td>Currency</td><td>Amount due.</td></tr>
<tr><td>currency</td><td>String</td><td>Yes</td><td>e.g., USD</td><td>Invoice currency.</td></tr>
<tr><td>invoice_pdf_url</td><td>String</td><td>No</td><td>URL</td><td>Link to invoice PDF.</td></tr>
</tbody></table>
</div>
<hr />
<h2 id="invoicelineitem"><a class="header" href="#invoicelineitem">InvoiceLineItem</a></h2>
<p>Detailed breakdown of charges on a specific invoice.</p>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Type</th><th>Required?</th><th>Format</th><th>Description</th></tr></thead><tbody>
<tr><td>line_item_id</td><td>UUID</td><td>Yes</td><td>UUID</td><td>Primary key.</td></tr>
<tr><td>invoice_id</td><td>UUID</td><td>Yes</td><td>UUID</td><td>FK to Invoice.</td></tr>
<tr><td>description</td><td>String</td><td>Yes</td><td>Free text</td><td>Charge description.</td></tr>
<tr><td>quantity</td><td>Integer</td><td>Yes</td><td>Positive</td><td>Quantity.</td></tr>
<tr><td>unit_price</td><td>Decimal</td><td>Yes</td><td>Currency</td><td>Price per unit.</td></tr>
<tr><td>total_amount</td><td>Decimal</td><td>Yes</td><td>Currency</td><td>Total (quantity × unit price).</td></tr>
<tr><td>service_period_start</td><td>Timestamp</td><td>Yes</td><td>ISO 8601</td><td>Service start.</td></tr>
<tr><td>service_period_end</td><td>Timestamp</td><td>Yes</td><td>ISO 8601</td><td>Service end.</td></tr>
</tbody></table>
</div>
<hr />
<h2 id="usagemetric"><a class="header" href="#usagemetric">UsageMetric</a></h2>
<p>Time-series table tracking API usage and billable activities. Modified to link overages to a specific invoice, supporting feature SB-003.</p>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Type</th><th>Required?</th><th>Format</th><th>Description</th></tr></thead><tbody>
<tr><td>user_id</td><td>UUID</td><td>Yes</td><td>UUID</td><td>FK to User (PK).</td></tr>
<tr><td>timestamp</td><td>Timestamp</td><td>Yes</td><td>ISO 8601</td><td>When usage occurred (PK).</td></tr>
<tr><td>metric_type</td><td>Enum</td><td>Yes</td><td>API_CALL, DATA_POINTS, HISTORICAL_REQUESTS</td><td>Usage type (PK).</td></tr>
<tr><td>invoice_id</td><td>UUID</td><td>No</td><td>UUID</td><td>FK to Invoice.</td></tr>
<tr><td>endpoint</td><td>String</td><td>No</td><td>API Path</td><td>Called endpoint.</td></tr>
<tr><td>count</td><td>Integer</td><td>Yes</td><td>Positive</td><td>Units consumed.</td></tr>
<tr><td>billable_units</td><td>Integer</td><td>Yes</td><td>Positive</td><td>Billable units.</td></tr>
<tr><td>overage</td><td>Boolean</td><td>Yes</td><td>true/false</td><td>Was it over quota?</td></tr>
<tr><td>metadata</td><td>JSON</td><td>No</td><td>JSON object</td><td>Additional usage context.</td></tr>
</tbody></table>
</div>
<hr />
<h2 id="enterprisecontract"><a class="header" href="#enterprisecontract">EnterpriseContract</a></h2>
<p>Stores custom enterprise contract terms and SLAs, supporting feature SB-005.</p>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Type</th><th>Required?</th><th>Format</th><th>Description</th></tr></thead><tbody>
<tr><td>contract_id</td><td>UUID</td><td>Yes</td><td>UUID</td><td>Primary key.</td></tr>
<tr><td>user_id</td><td>UUID</td><td>Yes</td><td>UUID</td><td>FK to User.</td></tr>
<tr><td>contract_name</td><td>String</td><td>Yes</td><td>Free text</td><td>Contract name.</td></tr>
<tr><td>start_date</td><td>Timestamp</td><td>Yes</td><td>ISO 8601</td><td>Start date.</td></tr>
<tr><td>end_date</td><td>Timestamp</td><td>Yes</td><td>ISO 8601</td><td>End date.</td></tr>
<tr><td>monthly_fee</td><td>Decimal</td><td>Yes</td><td>Currency</td><td>Fixed monthly fee.</td></tr>
<tr><td>volume_tiers</td><td>JSON</td><td>No</td><td>JSON array</td><td>Volume discounts.</td></tr>
<tr><td>sla_uptime</td><td>Float</td><td>Yes</td><td>0.0 - 1.0</td><td>Uptime guarantee.</td></tr>
<tr><td>sla_response_time</td><td>Integer</td><td>Yes</td><td>Milliseconds</td><td>Response time SLA.</td></tr>
<tr><td>custom_features</td><td>JSON</td><td>No</td><td>JSON array</td><td>Custom features.</td></tr>
<tr><td>support_level</td><td>String</td><td>Yes</td><td>Free text</td><td>Support description.</td></tr>
<tr><td>account_manager</td><td>String</td><td>No</td><td>Free text</td><td>Assigned manager.</td></tr>
<tr><td>renewal_terms</td><td>Text</td><td>No</td><td>Free text</td><td>Renewal conditions.</td></tr>
<tr><td>status</td><td>Enum</td><td>Yes</td><td>DRAFT, ACTIVE, EXPIRED, TERMINATED</td><td>Contract status.</td></tr>
<tr><td>created_at</td><td>Timestamp</td><td>Yes</td><td>ISO 8601</td><td>Created at.</td></tr>
<tr><td>updated_at</td><td>Timestamp</td><td>Yes</td><td>ISO 8601</td><td>Last modified.</td></tr>
</tbody></table>
</div>
<hr />
<h2 id="relationships"><a class="header" href="#relationships">Relationships</a></h2>
<h2 id="relationships-1"><a class="header" href="#relationships-1">Relationships</a></h2>
<ul>
<li><code>User [user_id (PK)]</code> 1 → 1 <code>UserSubscription [user_id (FK)]</code></li>
<li><code>SubscriptionTier [tier_id (PK)]</code> 1 → * <code>UserSubscription [tier_id (FK)]</code></li>
<li><code>User [user_id (PK)]</code> 1 → * <code>PaymentMethod [user_id (FK)]</code></li>
<li><code>UserSubscription [subscription_id (PK)]</code> 1 → ? <code>PaymentMethod [payment_method_id (FK)]</code></li>
<li><code>User [user_id (PK)]</code> 1 → * <code>Invoice [user_id (FK)]</code></li>
<li><code>Invoice [invoice_id (PK)]</code> 1 → * <code>InvoiceLineItem [invoice_id (FK)]</code></li>
<li><code>User [user_id (PK)]</code> 1 → * <code>UsageMetric [user_id (FK)]</code></li>
<li><code>Invoice [invoice_id (PK)]</code> 1 → * <code>UsageMetric [invoice_id (FK)]</code></li>
<li><code>User [user_id (PK)]</code> 1 → 1 <code>EnterpriseContract [user_id (FK)]</code></li>
</ul>
<hr />
<h2 id="entities--relationships-summary"><a class="header" href="#entities--relationships-summary">Entities &amp; Relationships Summary</a></h2>
<ul>
<li><strong>SubscriptionTier</strong>
<ul>
<li><code>tier_id (PK)</code></li>
</ul>
</li>
<li><strong>UserSubscription</strong>
<ul>
<li><code>subscription_id (PK)</code></li>
<li><code>user_id (FK → User.user_id)</code></li>
<li><code>tier_id (FK → SubscriptionTier.tier_id)</code></li>
<li><code>payment_method_id (FK → PaymentMethod.payment_method_id)</code></li>
</ul>
</li>
<li><strong>PaymentMethod</strong>
<ul>
<li><code>payment_method_id (PK)</code></li>
<li><code>user_id (FK → User.user_id)</code></li>
</ul>
</li>
<li><strong>Invoice</strong>
<ul>
<li><code>invoice_id (PK)</code></li>
<li><code>user_id (FK → User.user_id)</code></li>
<li><code>subscription_id (FK → UserSubscription.subscription_id)</code></li>
</ul>
</li>
<li><strong>InvoiceLineItem</strong>
<ul>
<li><code>line_item_id (PK)</code></li>
<li><code>invoice_id (FK → Invoice.invoice_id)</code></li>
</ul>
</li>
<li><strong>UsageMetric</strong>
<ul>
<li><code>user_id (PK, FK → User.user_id)</code></li>
<li><code>timestamp (PK)</code></li>
<li><code>metric_type (PK)</code></li>
<li><code>invoice_id (FK → Invoice.invoice_id)</code></li>
</ul>
</li>
<li><strong>EnterpriseContract</strong>
<ul>
<li><code>contract_id (PK)</code></li>
<li><code>user_id (FK → User.user_id)</code></li>
</ul>
</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../Crypto_Market_Data/Data_Defination_Sheet/7-api-key-management--authentication.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../../Crypto_Market_Data/Data_Defination_Sheet/8-rate-limiting--quota-management.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../Crypto_Market_Data/Data_Defination_Sheet/7-api-key-management--authentication.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../../Crypto_Market_Data/Data_Defination_Sheet/8-rate-limiting--quota-management.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
